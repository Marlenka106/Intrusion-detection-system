# Пояснение архитектурных и технических решений

##  Цель системы
Разработать надёжную, легко поддерживаемую систему обнаружения проникновения на запрещённую территорию с минимальным уровнем ложных срабатываний, чёткой визуальной обратной связью и возможностью последующего анализа (запись видео).

##  Архитектура проекта

### Принципы
- **KISS (Keep It Simple, Stupid)**: минимум абстракций, понятный код без избыточной инженерии.
- **DRY (Don’t Repeat Yourself)**: логика вынесена в отдельные модули (`detector.py`, `zone_checker.py`, `tracker.py`).
- **Модульность**: каждый компонент отвечает за одну задачу:
  - `detector.py` — только детекция
  - `zone_checker.py` — проверка и отрисовка зон
  - `tracker.py` — трекинг объектов
  - `main.py` — оркестрация и UI

### Структура

src/
├── main.py # точка входа, логика запуска, тревога, запись  
├── detector.py # YOLOv8 для детекции людей  
├── zone_checker.py # проверка проникновения и отрисовка зон  
└── tracker.py # DeepSORT для трекинга  


Такой подход позволяет легко тестировать, заменять и расширять компоненты (например, подключить другую модель детекции).

##  Выбор библиотек

### YOLOv8 (`ultralytics`)
- **Почему**: официальная, поддерживаемая реализация; простая интеграция; поддержка CPU/GPU «из коробки»; точность достаточна для задачи детекции людей.
- **Альтернативы**: YOLOv5, Detectron2 — более сложны в настройке или требуют больше ресурсов.

### DeepSORT (`deep-sort-realtime`)
- **Почему**: улучшает стабильность трекинга, снижает ложные срабатывания при кратковременной потере детекции (например, из-за перекрытия объектов).
- **Решение**: передаём кадр в трекер для извлечения эмбеддингов — обеспечивает надёжную идентификацию даже при изменении bbox.
- **Без трекинга**: система работала бы менее надёжно — тревога могла бы «мигать» при потере детекции на 1–2 кадра.

### OpenCV
- **Почему**: требование задания + идеален для:
  - работы с видео (`VideoCapture`, `VideoWriter`)
  - геометрических операций (`pointPolygonTest`)
  - отрисовки (`rectangle`, `putText`, `polylines`)

### JSON для хранения зон
- **Почему**: человекочитаемый формат, легко редактировать вручную, не требует БД.
- **Структура**: `[{ "points": [[x1,y1], [x2,y2], ...] }]` — поддерживает произвольные полигоны.

##  Особенности реализации

### Проверка проникновения
- Используется **центр bounding box** как репрезентативная точка человека.
- Проверка: `cv2.pointPolygonTest(polygon, center, measureDist=False) >= 0`
  - Включает как «внутри», так и «на границе» — безопаснее для задачи безопасности.

### Логика тревоги
- Тревога **включается мгновенно** при обнаружении человека в зоне.
- **Выключается через 3 секунды**, если **никто не находится в зоне**.
- Это предотвращает преждевременное отключение при кратковременном выходе человека за пределы кадра.

### Запись видео
- Автоматически сохраняется в `output/alarmed_video.mp4`.
- Включает: зоны, ID людей, bounding boxes, текст «ALARM!» — готово к архивированию и анализу.

### Режим разметки
- Запускается автоматически при отсутствии `restricted_zones.json`.
- Пользователь кликает по кадру → строит полигон → сохраняет.
- Реализовано через `cv2.setMouseCallback` — простой и интуитивный UX.

##  Производительность и ограничения

- Работает на **CPU** (с падением FPS), но поддерживает **GPU** при наличии CUDA.
- Использована лёгкая модель `yolov8n.pt` — баланс скорости и точности.
- DeepSORT с `embedder="mobilenet"` — приемлемая нагрузка даже на CPU.

##  Возможные улучшения
- Фильтрация по размеру bbox (игнорировать очень маленьких людей — вероятно, ложные срабатывания)
- Отправка уведомлений (email, Telegram) при тревоге
- Поддержка нескольких камер
- Веб-интерфейс (Flask/FastAPI + React)

##  Заключение
Система полностью соответствует требованиям тестового задания:
- Чистая архитектура (KISS, DRY)
- Git-коммиты по этапам
- YOLO + OpenCV
- Интерактивная разметка зон
- Тревога с таймером
- DeepSORT и запись видео — как «плюс»

Проект готов к демонстрации и дальнейшему развитию.